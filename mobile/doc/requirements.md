# 需求明细（MVP → 进阶）

本页把移动端壳（RN + Expo）要实现的功能进行可交付化拆分，结合你给的 5 张参考图：

## 产品定位
- 将当前 Web/Server 的能力打包为移动 App，提供随时聊天与角色管理能力。
- 以“参数可调”和“角色卡导入/创建”为核心价值，尽量延续桌面端/网页端的体验与术语。

## 角色与术语
- 用户（User）：使用 App 的人。
- 角色（Character）：可创建/导入（JSON/PNG），用于聊天。
- 聊天会话（Chat）：与单个角色/群组的对话线程。
- API 连接（API Connection）：如 openai/claude/gemini/openrouter 等供应商与模型配置。
- 世界书/预设/规则：可选的高级上下文素材，后续版本可逐步支持。

## MVP 范围（v0.1）
1) 启动与导航
   - 首屏进入“最近会话”或“角色列表”。
   - 左侧抽屉：会话侧边栏（图3）：展示会话列表，+ 按钮创建/导入角色；底部入口：API 连接。
   - 右侧抽屉：参数面板（图5）：当前会话的模型与推理参数配置。

2) 聊天页（图1）
   - 顶部：
     - 左上：打开左侧抽屉（会话/角色/导入）。
     - 右上：打开右侧抽屉（参数设置）。
   - 中部：
     - 气泡式消息流（支持基本富文本、代码块、图片缩略）。
     - 连续滚动与分页加载历史。
   - 底部输入框：
     - 文本输入与发送。
     - 基础多模态占位（图片发送，先保留入口，后续实现）。
   - 打字中/流式生成指示；中止按钮。

3) 角色创建/导入（图2）
   - 新建角色：基本字段（名称、头像、简介、系统提示/预设）。
   - 文件导入：支持 JSON 或 PNG（读取/写入 PNG 元数据中的 chara/ccv3）。
   - URL 导入：后续版本支持，MVP 先占位。

4) API 连接（图4）
   - 列表页：展示已保存的连接项；设置默认项。
   - 新建/编辑：供应商（openai/claude/gemini/openrouter/custom 等）、密钥、基础端点、默认模型、采样参数等。
   - 本地安全存储：AsyncStorage/Expo SecureStore（密钥）。

5) 参数设置（图5）
   - 依当前供应商展示可用参数：
     - model、maxTokens、temperature、top_p、top_k、frequency_penalty、presence_penalty、min_p、seed 等。
   - 推理策略：前缀/合并模式、工具调用开关（先 UI 勾选，功能分阶段接入）。

6) 数据与持久化
   - 会话、角色、API 连接、基础设置的本地持久化（AsyncStorage）。
   - 资源（头像、角色卡图片）放 App 沙盒；支持从相册/文件系统选择。

7) 网络与调用
   - 通过移动端直连官方/第三方 API（需代理可通过自定义端点）。
   - 支持流式输出（Server-Sent Events 或 chunked fetch）。
   - 错误提示与重试。

8) 复用后端逻辑
   - 复用 `src/prompt-converters.js` 的消息转换策略（必要 polyfill）。
   - 复用 `src/constants.js` 中的常量映射（如键名、推理 effort 映射等）。
   - 复用 `src/character-card-parser.js` 的 PNG 元数据读写（需 FS/Buffer 适配）。

## 非功能性需求
- 响应速度：首屏 < 2s；消息发送到首 token < 1.5s（网络可变）
- 稳定性：崩溃率 < 0.5%
- 存储：本地数据有备份/导出入口
- 隐私：密钥加密存储；允许“仅走 HTTPS”；可配置代理
- 国际化：首期中文，保留 i18n 结构
- 深色主题：跟随系统 + 手动切换

## 进阶范围（v0.2+）
- 文件/图片/音频输入（ASR、TTS 播放）
- 群聊模式与世界书/规则/预设完整支持
- 云同步（iCloud/Drive 或自建后端）
- 离线缓存、模型切换策略、日志导出
- 插件生态对接（选型后定义）
